
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[t]{Generalized covariate balance for MrP}

\textbf{Step one:} Construct
$\ytil$ such that $\expect{}{\ytil \vert \x} = \expect{}{\y \vert \x} + \delta f(\x)$.
\pause

\textbf{Problem:} Our $\y$ is binary!  (We're motivated by hierarchical linear regression.)

\pause
Two possibilities:
%
\begin{itemize}
    \item Allow $\ytil$ to take values other than $\{0,1\}$ and set
        $\ytil = \y + \delta \f(\x)$, or
    \item Use an estimate of $\expect{}{\y \vert \x}$ to draw new binary $\ytil$.
\end{itemize}
%
Our approach:
%
\begin{itemize}
    \item Use $\ytil = \y + \delta \f(\x)$ to identify problematic ``imbalanced'' $\f(\x)$
    \item Sanity check by generating binary $\ytil$ using $\f(\x)$ (which is fast and easy)
\end{itemize}


\end{frame}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[t]{Generalized covariate balance for MrP}

\textbf{Step one:} Construct
$\ytil$ such that $\expect{}{\ytil \vert \x} = \expect{}{\y \vert \x} + \delta f(\x)$.\\
\pause
\textbf{Step two:} Evaluate \surcol{$\muhat_\mrp(\ytil) - \muhat(\y)$}.
\pause

\textbf{Problem:} \surcol{$\muhat_\mrp(\cdot)$} is computed with MCMC.
%
\begin{itemize}
\item Each MCMC run typically takes hours, and
\item Output is noisy, and \surcol{$\muhat_\mrp(\ytil) - \muhat_\mrp(\y)$} may be small.
\end{itemize}
%

\pause
\begin{block}{MrP Local Equivalent Weights (MrPlew)}
Form the first-order Taylor series approximation
\surcol{
$$
\muhat_{\mrp}(\ytil) - \muhat_\mrp(\y) \approx
    \sumsur \w_i^\mrp (\ytil_i  - \y_i)
\quad\textrm{where}\quad
    \wmrp_i := \frac{d}{d\y_i} \muhat_{\mrp}(\y).
$$
}
\end{block}

\only<5>{
\textbf{Use in BISC: } For a wide set of judiciously chosen $\f(\cdot)$, check
$$
\surcol{
\underset{\approx \muhat_{\mrp}(\ytil) - \muhat_\mrp(\y)}{
\delta \sumsur \w_i^\mrp \f(\x_i)}}
        \overset{\textrm{check}}{\approx}
    \tarcol{
        \delta \meantar f(\x_j).}
$$

This a \textbf{sensitivity analysis} that formally coincides with a
\textbf{balance check}.
}



\only<6>{
\textbf{Computation: }
The weights are given by weighted averages of posterior covariances  \footcite{giordano:2018:covariances}.
\\[1em]
They can be easily computed with standard software\footnote{We use \texttt{brms} \parencite{brms}.}
\textbf{without re--running MCMC}.\\
}


\only<7>{
%
\textbf{Theory: }
We state conditions under which, as $\delta \rightarrow 0$, and $N \rightarrow \infty$,
\begin{itemize}
\item The residual is of lower order than the MrPlew term,
\item \textit{Uniformly} over a very wide class of $\f(\cdot)$.
\end{itemize}
%
\textbf{Uniformity} is the hard part, but this justifies
using MrPlew to \textit{identify} problematic $\f(\cdot)$.

Builds on earlier work on uniform error bounds
for Bernstein--von Mises theorem(--ish) results
\footcite{giordano:2024:bayesij,kasprzak:2025:laplace}.
}

\end{frame}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% \begin{frame}[Putting it all together]

% \textbf{Use in BISC: } For a wide set of judiciously chosen $\f(\cdot)$, check
% $$
% \surcol{
% \underset{\approx \muhat_{\mrp}(\ytil) - \muhat_\mrp(\y)}{
% \delta \sumsur \w_i^\mrp \f(\x_i)}}
%         \overset{\textrm{check}}{\approx}
%     \tarcol{
%         \delta \meantar f(\x_j).}
% $$

% This a \textbf{sensitivity analysis} that formally coincides with a
% \textbf{balance check}.

% \end{frame}
